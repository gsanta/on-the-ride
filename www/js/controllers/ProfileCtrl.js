// Generated by CoffeeScript 1.7.1
(function() {
  angular.module("controllers").controller('ProfileCtrl', function($scope, DataProvider, LoginService, UserService) {
    var promise;
    promise = DataProvider.getUserInfo("gsanta");
    promise.then(function(data) {
      $scope.user = data;
      return $scope.savedUser = angular.copy($scope.user);
    });
    $scope.user = {};
    $scope.savedUser = {};
    $scope.newPassword = void 0;
    $scope.passwordChange = {};
    $scope.getCssClasses = function(ngModelContoller) {
      return {
        error: ngModelContoller.$invalid && ngModelContoller.$dirty
      };
    };
    $scope.showError = function(ngModelController, error) {
      console.log("shoError: " + ngModelController.$error[error]);
      return ngModelController.$error[error];
    };
    $scope.canSaveForm = function(form) {
      return form.$valid;
    };
    $scope.canSaveProfileForm = function(form) {
      console.log($scope.savedUser);
      return form.$valid && ($scope.user.email !== $scope.savedUser.email);
    };
    $scope.submitPasswordChangeForm = function(form) {
      if (form.$dirty && form.$invalid) {
        return;
      }
      promise = LoginService.changePassword($scope.user.userName, $scope.passwordChange.password, $scope.passwordChange.newPassword);
      return promise.then(function() {
        $scope.passwordChange = {};
        form.$setPristine();
        return $scope.passwordFlashMessage = "changes saved";
      });
    };
    return $scope.submitProfileForm = function(form) {
      if (form.$dirty && form.$invalid) {
        return;
      }
      promise = UserService.changeProfileData($scope.user.userName, $scope.user);
      return promise.then(function(User) {
        $scope.user = User;
        $scope.savedUser = angular.copy($scope.user);
        form.$setPristine();
        return $scope.profileFlashMessage = "changes saved";
      });
    };
  });

}).call(this);
